#!/usr/bin/env python2
# -*- mode: python -*-

import sys
import os

from pheweb import version
from pheweb.load import phenolist
from pheweb.load import get_cpras
from pheweb.load import merge_cpras
from pheweb.load import download_rsids
from pheweb.load import download_genes
from pheweb.load import add_rsids
from pheweb.load import make_tries
from pheweb.load import standardize_phenos
from pheweb.load import make_manhattan
from pheweb.load import make_qq
from pheweb.load import make_matrix
from pheweb.load import bgzip_phenos
from pheweb.load import top_loci
from pheweb.load import process_assoc_files

def serve_run(argv):
    from pheweb.serve import server
    server.run(argv)

handlers = {}
handlers['phenolist'] = phenolist.run
handlers['get-cpras'] = get_cpras.run
handlers['merge-cpras'] = merge_cpras.run
handlers['download-rsids'] = download_rsids.run
handlers['download-genes'] = download_genes.run
handlers['add-rsids'] = add_rsids.run
handlers['make-tries'] = make_tries.run
handlers['standarize-phenos'] = standardize_phenos.run
handlers['make-manhattan'] = make_manhattan.run
handlers['make-qq'] = make_qq.run
handlers['make-matrix'] = make_matrix.run
handlers['bgzip-phenos'] = bgzip_phenos.run
handlers['top-loci'] = top_loci.run
handlers['process-assoc-files'] = process_assoc_files.run
handlers['serve'] = serve_run


def help():
    print('''\
PheWeb {}

To see more information about a subcommand, run that command followed by `-h`.

Subcommands:

    pheweb phenolist
        prepare a list of phenotypes

    pheweb process-assoc-files
        once a phenolist has been prepared, load all data to be ready to run the server.

    pheweb serve
        host a webserver
'''.format(version.version))

subcommand = sys.argv[1] if len(sys.argv)>1 else ''
if subcommand in ['', '-h', '--help']:
    help()
elif subcommand not in handlers:
    print('Unknown subcommand {!r}'.format(subcommand))
    help()
else:
    handlers[subcommand](sys.argv[2:])
